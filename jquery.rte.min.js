/*
 * n.rte
 * 
 * Version: 1.1.0
 * License: License: MIT (https://raw.github.com/zanmoskotevc/n.rte/master/LICENSE)
 * 
 */
(function(a){a.rte=function(d,c){var e=this;e.$el=a(d);e.el=d;e.$el.data("rte",e);var b="rte";e.init=function(){e.options=a.extend({},a.rte.defaultOptions,c);var m=[];a.each(e.options.commands.split("|"),function(p,s){var q=s.split(","),r=q[0];m[r]={stripIndex:p,name:r,title:q[1]===""?r.charAt(0).toUpperCase()+r.substr(1):q[1],command:q[2]===""?r:q[2],popup:q[3]===""?r:q[3]}});e.$el.hide();var k=a("<div>").addClass(b).width(e.options.width).height(e.options.height).insertBefore(e.$el).append(e.$el);var o=a('<iframe frameborder="0" src="javascript:true;" />').appendTo(k);var n=o[0].contentWindow.document,h=a(n);n.open();n.write(e.options.frameDoc+"<html>"+((e.options.frameCSS==="")?"":'<head><link rel="stylesheet" type="text/css" href="'+e.options.frameCSS+'" /></head>')+'<body style="'+e.options.frameBody+'" class="body-editor">'+e.$el.val()+"</body></html>");n.close();n.designMode="on";var g=a("<div>").addClass(b+"-toolbar").prependTo(k);var j=a("<div>").addClass(b+"-buttons").appendTo(g);var l=a('<input type="hidden" />').val("0");var f=a("<div>").addClass(b+"-popup").css("position","absolute").prependTo(k).hide();e.$wrapper=k;e.$iframe=o;e.$doc=h;e.$toolbar=g;e.$buttongroup=j;e.$view=l;e.$popup=f;e.buttons=m;a.each(e.options.controls.split(" "),function(p,r){if(r===""){return true}if(r=="|"){var q=a("<div>").addClass(b+"-separator").appendTo(j);j=a("<div>").addClass(b+"-buttons").appendTo(g)}else{var s=m[r];var t=a("<div>").data("buttonName",s.name).addClass(b+"-button").addClass(b+"-"+s.name).attr("title",s.title).bind("click",a.proxy(e.buttonClick,e)).appendTo(j)}});o.width(k.width()).height(k.outerHeight()-g.outerHeight()-2);e.$el.width(k.width()).height(k.outerHeight()-g.outerHeight()-2);e.$doc.click(function(){e.$popup.fadeOut(150,function(){a(this).html("")})});e.$iframe.contents().find("body").html(e.$el.val());e.$doc.keyup(function(){e.updateEditor(e)});e.$doc.mouseup(function(){e.updateEditor(e)})};e.buttonClick=function(h){var g=this;buttonDiv=h.target;buttonName=a(buttonDiv).data("buttonName");button=g.buttons[buttonName];var f={editor:g,button:buttonDiv,buttonName:buttonName,command:button.command,value:null,useCSS:g.options.useCSS,popup:button.popup};if(f.buttonName=="html"){if(g.$view.val()=="0"){a(".rte-html").addClass(b+"-html-active");g.updateEditor(g);g.$el.show();g.$iframe.hide();g.$toolbar.fadeTo(150,0.5);g.$view.val("1")}else{a(".rte-html").removeClass(b+"-html-active");g.updateFrame();g.$el.hide();g.$iframe.show();g.$toolbar.fadeTo(150,1);g.$view.val("0")}}else{if(f.popup){g.popupCommand(f.popup,f.button,f.command,g)}else{g.execCommand(g,f.command,f.value,f.useCSS,f.button)}}g.$iframe.focus()};e.execCommand=function(f,j,h){if(e.$view.val()=="0"){try{success=f.$doc[0].execCommand(j,false,h||false)}catch(g){console.log(g)}if(!success){if("cutcopypaste".indexOf(j)>-1){alert("Your browser disabled the "+j+"command for security reasons. Use the keyboard shortcut or right-click menu instead.")}}}e.updateEditor(f)};e.popupCommand=function(k,h,m,j){if(e.$view.val()=="0"){if(e.$popup.css("display")=="none"){var f=a(h).position();f.top+=26;e.$popup.css({top:f.top,left:f.left});e.$popup.width("auto");if(k=="url"){e.$popup.html('<strong>Insert URL</strong><br /><input type="text" size="20" /><br /><input type="button" value="Insert" />');e.$popup.children('input[type="button"]').click(function(){e.$popup.fadeOut();e.popupClick(e,m,e.$popup.children('input[type="text"]').val())})}else{if(k=="img"){e.$popup.html('<strong>Insert URL of image</strong><br /><input type="text" size="20" /><br /><input type="button" value="Insert" />');e.$popup.children('input[type="button"]').click(function(){e.$popup.fadeOut();e.popupClick(e,m,e.$popup.children('input[type="text"]').val())})}else{if(k=="color"){e.$popup.width(96);var g=e.options.colors.split(" ");if(g.length<10){e.$popup.width("auto")}a.each(g,function(n,o){a("<div>").appendTo(e.$popup).addClass(b+"-popup-color").css("background-color","#"+o)});e.$popup.children("."+b+"-popup-color").click(function(){e.$popup.fadeOut();e.popupClick(e,m,a(this).css("background-color"))})}else{if(k=="format"){for(i=1;i<7;i++){a("<h"+i+' class="h'+i+'">Heading '+i+"</h"+i+">").click(function(){e.$popup.fadeOut();e.popupClick(e,m,a(this).attr("class").substr(0,2))}).addClass(b+"-popup-format").appendTo(e.$popup)}}else{if(k=="size"){var l=e.options.sizes.split(",");a.each(l,function(n,o){a("<span>Font "+o+"</span><br />").appendTo(e.$popup).addClass(b+"-popup-size").css("font-size",o+"px")});e.$popup.children("."+b+"-popup-size").click(function(){e.$popup.fadeOut();e.popupClick(e,m,a(this).css("font-size"))})}else{}}}}}e.$popup.fadeIn()}else{e.$popup.fadeOut(150,function(){a(this).html("")})}}};e.popupClick=function(f,h,g){if(h=="insertImage"&&a.browser.mozilla){e.execCommand(f,"enableObjectResizing");e.execCommand(f,h,g)}else{e.execCommand(f,h,g)}};e.updateEditor=function(){var f=e.$iframe.contents().find("body").html();f.replace(/<i>(.*?)<\/i>/g,"<em>$1</em>").replace(/<b>(.*?)<\/b>/g,"<strong>$1</strong>").replace(/<(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param|embed)(.*?)[^ \/]>/igm,"<$1$2 />");e.$el.val(f)};e.updateFrame=function(){e.$iframe.contents().find("body").html(e.$el.val())};e.init()};a.rte.defaultOptions={width:650,height:250,controls:"bold italic underline strikethrough | format fontsize color hilite | alignleft center alignright justify | bullets numbering | image link unlink | undo redo | cut copy paste | html",commands:"bold,Bold (Ctrl/Cmd + B),|italic,Italic (Ctrl/Cmd + I),|underline,Underline (Ctrl/Cmd + U),|strikethrough,,|subscript,,|superscript,,|color,Font Color,forecolor,color|hilite,Text Highlight Color,hilitecolor,color|backcolor,Background color,,color|format,Format block,formatBlock,format|fontsize,Change text size,fontsize,size|alignleft,Align Left,justifyleft|center,Centered,justifycenter|alignright,Align Right,justifyright|justify,Justified,justifyfull|bullets,Unordered list,insertunorderedlist|numbering,Ordered list,insertorderedlist|image,Insert Image,insertimage,img|link,Insert Link,createlink,url|unlink,Remove Link,|undo,Undo (Ctrl/Cmd + Z),|redo,Redo (Ctrl/Cmd + Y)|cut,Cut (Ctrl/Cmd + X),|copy,Copy (Ctrl/Cmd + C),|paste,Paste (Ctrl/Cmd + V),|html,Show source",colors:"FFF CCC 999 666 333 000 F00 E00 C00 900 600 300 0F0 0E0 0C0 090 060 030 00F 00E 00C 009 006 003",fonts:"Helvetica,Arial,Arial Black,Tahoma,Courier New,Verdana",sizes:"9,10,11,12,14,16,18",useCSS:false,frameDoc:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',frameCSS:"",frameBody:"margin:6px;font:10pt Arial,Verdana;cursor:text;"};a.fn.rte=function(b){return this.each(function(){(new a.rte(this,b))})}})(jQuery);